(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{235:function(e,t,r){"use strict";r.d(t,"b",(function(){return R})),r.d(t,"d",(function(){return O})),r.d(t,"a",(function(){return l.c}));var n=r(9),o=r(10),c=(r(34),r(20)),d=r(42),l=r(124),m=d.a.ASSETMANAGER_PATH,E=Object(n.a)({},l.a.SAVE_RPM_AVATAR,(function(e,t){var r=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,d,content,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.avatarId,o=t.url,e.next=4,r.$httpClient.post("".concat(m,"/character/rpm"),{avatarId:n,url:o});case 4:return d=e.sent,content=d.data,l=content.fileId,e.abrupt("return",l);case 10:e.prev=10,e.t0=e.catch(0),c.a.error({error:e.t0},"Encounter error saving RPM avatar");case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))()})),f=Object(n.a)({},l.b.SET_SHOW_READY_PLAYER_ME_MODAL,(function(e,t){e.showReadyPlayerMeModal=t})),O=(r(40),{setShowReadyPlayerMeModal:function(e,t){(0,e.commit)("".concat(l.c,"/").concat(l.b.SET_SHOW_READY_PLAYER_ME_MODAL),t,{root:!0})}}),R={saveRpmAvatar:function(e,t,r){return(0,e.dispatch)("".concat(l.c,"/").concat(l.a.SAVE_RPM_AVATAR),{avatarId:t,url:r},{root:!0})}};t.c={namespaced:!0,state:function(){return{showReadyPlayerMeModal:!1}},mutations:f,actions:E}},80:function(e,t,r){"use strict";r.d(t,"a",(function(){return J})),r.d(t,"d",(function(){return ee})),r.d(t,"f",(function(){return te})),r.d(t,"c",(function(){return ae})),r.d(t,"b",(function(){return f})),r.d(t,"e",(function(){return O}));var n,o=r(9),c=r(10),d=(r(34),r(40),r(13),r(286),r(62),r(66),r(74),r(60),r(64),r(50),r(99),r(371),r(133),r(92),r(83),r(75),r(41),r(122),r(23),r(72),r(144),r(101)),l=r.n(d),m=r(15),E=r(63),f={exportVideo:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_VIDEO),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},exportGIF:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_GIF),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},exportVideoOrGIF:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_VIDEO_OR_GIF),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},exportImage:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_IMAGE),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},fetchFBXFiles:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.dispatch,t.abrupt("return",r("".concat(m.h,"/").concat(m.a.FETCH_FBX_FILES),void 0,{root:!0}));case 2:case"end":return t.stop()}}),t)})))()},cancelExportFBX:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.CANCEL_EXPORT_FBX),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},downloadFBXFile:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.DOWNLOAD_FBX_FILE),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},subscribeToExportFBXReady:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.dispatch,t.abrupt("return",r("".concat(m.h,"/").concat(m.a.SUBSCRIBE_TO_EXPORT_FBX_READY),void 0,{root:!0}));case 2:case"end":return t.stop()}}),t)})))()},exportFBX:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_FBX),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},exportProject:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_PROJECT),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},checkCanExport3dFile:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.dispatch,t.abrupt("return",r("".concat(m.h,"/").concat(m.a.CHECK_CAN_EXPORT_3D_FILE),void 0,{root:!0}));case 2:case"end":return t.stop()}}),t)})))()},subscribeToServerRenderProgress:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.dispatch,t.abrupt("return",r("".concat(m.h,"/").concat(m.a.SUBSCRIBE_TO_SERVER_RENDER_PROGRESS),void 0,{root:!0}));case 2:case"end":return t.stop()}}),t)})))()},serverRender:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.SERVER_RENDER),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},fetchExportDownloads:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.FETCH_EXPORT_DOWNLOADS),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},downloadExportDownload:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.DOWNLOAD_EXPORT_DOWNLOAD),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},downloadAiGeneratedFile:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.DOWNLOAD_AI_GENERATED_FILE),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},downloadServerRenderFileByRenderId:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.DOWNLOAD_SERVER_RENDER_FILE_BY_RENDER_ID),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},deleteServerRenderFile:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.DELETE_SERVER_RENDER_FILE),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},retryServerRenderExport:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.RETRY_SERVER_RENDER_EXPORT),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},cancelServerRenderExport:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.CANCEL_SERVER_RENDER_EXPORT),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},exportImageWithTransformation:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_IMAGE_WITH_TRANSFORMATION),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},exportAIStyledImageWithTransformation:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_AI_STYLED_IMAGE_WITH_TRANSFORMATION),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},populateImageToMyDownloads:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.POPULATE_IMAGE_TO_MY_DOWNLOADS),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},publishSceneToCommunity:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.PUBLISH_SCENE_TO_COMMUNITY),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},publishAISceneToCommunity:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.PUBLISH_AI_SCENE_TO_COMMUNITY),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},populateDefaultDownloadToMyDownloads:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.POPULATE_DEFAULT_DOWNLOAD_TO_MY_DOWNLOADS),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},countProjectExport:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.COUNT_PROJECT_EXPORT),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},pollOngoingServerExportStatus:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.dispatch,t.abrupt("return",r("".concat(m.h,"/").concat(m.a.POLL_ONGOING_SERVER_EXPORT_STATUS),void 0,{root:!0}));case 2:case"end":return t.stop()}}),t)})))()},removeImageBackground:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.REMOVE_IMAGE_BACKGROUND),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()},exportSelectedImage:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.dispatch,r.abrupt("return",n("".concat(m.h,"/").concat(m.a.EXPORT_SELECTED_IMAGE),t,{root:!0}));case 2:case"end":return r.stop()}}),r)})))()}},O={setShowExportFBXModal:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_SHOW_EXPORT_MODAL),t,{root:!0})},setShowExportImageModal:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_SHOW_EXPORT_IMAGE_MODAL),t,{root:!0})},setExportVideoModal:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_EXPORT_VIDEO_MODAL),t,{root:!0})},setExportGifModal:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_EXPORT_GIF_MODAL),t,{root:!0})},setShowExportProjectModal:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_SHOW_EXPORT_PROJECT_MODAL),t,{root:!0})},setExportedFBXFiles:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_EXPORTED_FBX_FILES),t,{root:!0})},updateExportFbxFile:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.UPDATE_EXPORT_FBX_FILE),t,{root:!0})},deleteFbxExportFile:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.DELETE_FBX_EXPORT_FILE),t,{root:!0})},setIsExportingVideo:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_IS_EXPORTING_VIDEO),t,{root:!0})},updateExportingVideoStatus:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.UPDATE_EXPORTING_VIDEO_STATUS),t,{root:!0})},setExportVideoPayload:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_VIDEO_EXPORT_PAYLOAD),t,{root:!0})},setExportModalActiveTab:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_EXPORT_MODAL_ACTIVE_TAB),t,{root:!0})},resetServerExportItems:function(e){(0,e.commit)("".concat(m.h,"/").concat(m.g.RESET_SERVER_EXPORT_ITEMS),void 0,{root:!0})},setExportItemsFilter:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_EXPORT_ITEMS_FILTER),t,{root:!0})},addOrUpdateServerExportItem:function(e,t){var r=e.commit;E.a.$services.serverRenderProgressSimulator.addOrUpdateServerExportItem(t,(function(e){r("".concat(m.h,"/").concat(m.g.ADD_OR_UPDATE_SERVER_EXPORT_ITEM),e,{root:!0})}))},removeServerExportItem:function(e,t){var r=e.commit;E.a.$services.serverRenderProgressSimulator.removeServerExportItem(t),r("".concat(m.h,"/").concat(m.g.REMOVE_SERVER_EXPORT_ITEM),t,{root:!0})},removeExportDownloadItem:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.REMOVE_EXPORT_DOWNLOAD_ITEM),t,{root:!0})},setIsFetchingExportDownloads:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_IS_FETCHING_EXPORT_DOWNLOADS),t,{root:!0})},setExportDownloads:function(e,t,r,n,o,c){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_EXPORT_DOWNLOADS),{items:t,totalItems:r,totalPages:n,currentPage:o,refresh:c},{root:!0})},addOrUpdateExportDownloadItem:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.ADD_OR_UPDATE_EXPORT_DOWNLOAD_ITEM),t,{root:!0})},setSelectedServerExportItem:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_SELECTED_SERVER_EXPORT_ITEM),t,{root:!0})},setServerExportItemToCancel:function(e,t){(0,e.commit)("".concat(m.h,"/").concat(m.g.SET_SERVER_EXPORT_ITEM_TO_CANCEL),t,{root:!0})},resetExportDownloads:function(e){(0,e.commit)("".concat(m.h,"/").concat(m.g.RESET_EXPORT_DOWNLOADS),void 0,{root:!0})}},R=r(52),h=r(141),x=r(16),v=r(32),_=r(127),I=r(47),T=r(854),S=r(311),w=r(238),j=r(59),D=r(20),P=r(343),y=r(42),A=r(312);function k(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,a){if(e){if("string"==typeof e)return F(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?F(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,c=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw c}}}}function F(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,r=Array(a);t<a;t++)r[t]=e[t];return r}var N,X,M,C=y.a.ASSETMANAGER_PATH,U=l.a.CancelToken;function L(e,t){return B.apply(this,arguments)}function B(){return(B=Object(c.a)(regeneratorRuntime.mark((function e(t,r){var n,o,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("".concat(C,"/export/renderer/aistylist/styles/").concat(r));case 2:if(n=e.sent,o=n.data,c=o.downloadFileName,!(d=o.presignedUrl)){e.next=6;break}return e.abrupt("return",{downloadFileName:c,presignedUrl:d});case 6:return e.abrupt("return",void 0);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t){return V.apply(this,arguments)}function V(){return(V=Object(c.a)(regeneratorRuntime.mark((function e(t,r){var n,o,c,d,l,m,E,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("".concat(C,"/export/renderer/status/").concat(r));case 2:if(n=e.sent,o=n.data,c=o.isFailed,d=o.outputFileId,l=o.exportType,m=o.fileName,E=o.format,f=o.downloaded,!c){e.next=6;break}throw new Error("Job failed");case 6:if(!d){e.next=8;break}return e.abrupt("return",{outputFileId:d,exportType:l,fileName:m,format:E,downloaded:f});case 8:return e.abrupt("return",void 0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t,r){return W.apply(this,arguments)}function W(){return(W=Object(c.a)(regeneratorRuntime.mark((function e(t,r,n){var o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("".concat(C,"/presigned/").concat(r),{params:{attachmentFilename:n}});case 2:return o=e.sent,c=o.data.presignedUrl,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(c.a)(regeneratorRuntime.mark((function e(t,r){var n,o,c,d,l,m,E,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.exportType,o=r.format,c=r.fileName,d=r.outputFileId,l=r.renderId,m="image"==n?"PNG"==o?"png":"jpg":"video"==n?"mp4":"gif",E="".concat(c,".").concat(m),e.next=5,$(t,d,E);case 5:f=e.sent,Object(j.c)(f,c),t.put("".concat(C,"/export/renderer/").concat(l),{downloaded:!0}).catch((function(){}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K,J=(n={},Object(o.a)(n,m.a.EXPORT_VIDEO,(function(e,t){for(var r=e.dispatch,n=t.projectTitle,o=t.format,c=t.width,d=t.height,l=t.startFrame,E=t.endFrame,f=t.fps,O=t.overridingWatermarkFlag,R=t.isDownload,h=void 0===R||R,x=[],i=l;i<=E;i++)x.push(i);return r("".concat(m.h,"/").concat(m.a.EXPORT_VIDEO_OR_GIF),{projectTitle:n,exportFrameIndices:x,width:c,height:d,fps:f,format:o,loadingMessage:"ANIMATION IS BEING RENDERED",exportType:"video",startFrame:l,endFrame:E,overridingWatermarkFlag:O,isDownload:h},{root:!0})})),Object(o.a)(n,m.a.EXPORT_GIF,(function(e,t){for(var r=e.dispatch,n=t.projectTitle,o=t.width,c=t.height,d=t.startFrame,l=t.endFrame,E=t.fps,f=t.transparentBackground,O=t.overridingWatermarkFlag,R=t.frameDropIncrement,h=t.isDownload,x=void 0===h||h,v=[],_=0,i=d;i<=l;i++){(_%1==0?_+1:Math.ceil(_))>_+R&&v.push(i),_+=R}return r("".concat(m.h,"/").concat(m.a.EXPORT_VIDEO_OR_GIF),{projectTitle:n,width:o,height:c,fps:E,format:"gif",loadingMessage:"ANIMATION IS BEING RENDERED",exportType:"gif",repeat:0,startFrame:d,endFrame:l,transparentBackground:f,overridingWatermarkFlag:O,exportFrameIndices:v,isDownload:x},{root:!0})})),Object(o.a)(n,m.a.EXPORT_VIDEO_OR_GIF,(function(e,t){var r=this,n=e.commit;return Object(_.a)().pauseAnimation(),new Promise(function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(o,d){var l,E,f,O,I,S,w,A,k,F,N,X,M,U,L,B,G,V,W,H,Y,K,J,z,Q,Z,ee,te,re,ne,ae,oe,ce,ie,ue;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.projectTitle,E=t.format,f=t.loadingMessage,O=t.exportType,I=t.fps,S=t.repeat,w=t.startFrame,A=t.endFrame,k=t.transparentBackground,F=void 0!==k&&k,N=t.overridingWatermarkFlag,X=t.exportFrameIndices,M=t.isDownload,U=t.width,L=t.height,U=U%2?U+1:U,L=L%2?L+1:L,n("".concat(m.h,"/").concat(m.g.UPDATE_EXPORTING_VIDEO_STATUS),{progress:0,message:f},{root:!0}),n("".concat(m.h,"/").concat(m.g.SET_IS_EXPORTING_VIDEO),!0,{root:!0}),B=A-w,G=w,V=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){var progress,t=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:!(t.length>0&&void 0!==t[0])||t[0]?(progress=Math.floor(99*(G-w)/B),n("".concat(m.h,"/").concat(m.g.UPDATE_EXPORTING_VIDEO_STATUS),{progress:progress,message:f},{root:!0})):(v.b.$widgets.shortcutManager.disableShortcuts=!1,Object(_.a)().setCurrentFrame(w),n("".concat(m.h,"/").concat(m.g.UPDATE_EXPORTING_VIDEO_STATUS),null,{root:!0}),h.a.open({message:"Processing...",type:x.g.INFO,duration:3e3}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=10,W=performance.now(),v.b.$widgets.shortcutManager.disableShortcuts=!0,H=Object(T.a)(),Y={jobId:H,fileName:l,exportType:O,fps:I,height:L,width:U,repeat:S},e.next=17,r.$httpClient.post("".concat(C,"/export/gifVideo/init"),Y);case 17:K=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){setTimeout(Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n=w!=G,o=X[X.length-1]!=G,r.next=5,Object(_.a)().exportImage(U,L,"gif"==O,F,n,o,N);case 5:c=r.sent,e({frameBase64:c}),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(0),t(r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,9]])}))),0)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=[],z=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(t){var r,n,o,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=X.indexOf(G),e.next=3,fetch(t);case 3:return n=e.sent,e.next=6,n.blob();case 6:return o=e.sent,c=F?"image/png":"image/jpg",d=F?"png":"jpg",e.next=11,v.b.$services.multiUploadService.multipartUpload(o,"gif"==O?y.b.GIF_EXPORTS:y.b.VIDEO_EXPORTS,{key:"".concat(H,"/").concat(r,".").concat(d),contentType:c});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Object(_.a)().setCurrentFrame(G);case 21:if(!(G<=A)){e.next=33;break}if(!X.includes(G)){e.next=28;break}return e.next=25,K();case 25:Q=e.sent,Z=Q.frameBase64,J.push(z(Z));case 28:V(),G+=1,Object(_.a)().setCurrentFrame(G),e.next=21;break;case 33:return e.next=35,Promise.all(J);case 35:return V(!1),e.next=38,r.$httpClient.put("".concat(C,"/export/gifVideo/execute/").concat(H));case 38:return ee=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.$httpClient.get("".concat(C,"/export/gifVideo/status/").concat(H));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=41,Object(P.a)(ee,84e4);case 41:if(te=e.sent,re=te.exportFileId,!te.isFailed){e.next=45;break}throw new Error("Failed to export gif or video");case 45:return ne="".concat(l,".").concat(E),e.next=48,$(r.$httpClient,re,ne);case 48:if(ae=e.sent,n("".concat(m.h,"/").concat(m.g.SET_IS_EXPORTING_VIDEO),!1,{root:!0}),Object(R.$notify)({clean:!0}),!M){e.next=59;break}Object(j.c)(ae,ne),D.a.log("Exported in : ".concat(performance.now()-W," ms")),"gif"==E?(oe="GIF Export",ce={"Is Transparent Background":F}):oe="Video Export",v.b.$mixpanel.track(oe,ce),o(),e.next=66;break;case 59:return e.next=61,fetch(ae);case 61:return ie=e.sent,e.next=64,ie.blob();case 64:ue=e.sent,o(ue);case 66:n("".concat(m.h,"/").concat(m.g.UPDATE_EXPORTING_VIDEO_STATUS),null,{root:!0}),e.next=78;break;case 69:e.prev=69,e.t0=e.catch(10),n("".concat(m.h,"/").concat(m.g.UPDATE_EXPORTING_VIDEO_STATUS),null,{root:!0}),D.a.error({error:e.t0},"Error while exporting video"),Object(R.$notify)({type:x.g.ERROR,title:"Problem occurred while exporting video. Please try again."}),n("".concat(m.h,"/").concat(m.g.SET_IS_EXPORTING_VIDEO),!1,{root:!0}),v.b.$widgets.shortcutManager.disableShortcuts=!1,Object(_.a)().setCurrentFrame(w),d(e.t0);case 78:case"end":return e.stop()}}),e,null,[[10,69]])})));return function(t,r){return e.apply(this,arguments)}}())})),Object(o.a)(n,m.a.EXPORT_IMAGE,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,d,l,E,R,I,S,A,k,F,N,X,M,U,L,B,G,V,$,W,H,Y,K,J,z,Q,image,Z,ee,te,re,ne,ae,oe,ce,ie,ue,se,pe,de,le,me,Ee,fe,ge,Oe,Re,be,he,xe;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=t.projectId,d=t.filename,l=t.width,E=t.height,R=t.isPng,I=t.transparentBackground,S=t.scaleFactor,A=void 0===S?1:S,k=t.background,F=t.backgroundEffect,N=t.isDownload,X=void 0===N||N,M=t.isPublish,U=void 0!==M&&M,L=t.addWatermark,B=void 0!==L&&L,G=t.sceneItemIds,V=void 0===G?[]:G,$=t.shouldCountExport,W=void 0===$||$,H=R?"image/png":"image/jpg",Y=R?m.k.PNG:m.k.JPEG,K=d+(R?".png":".jpg"),z=(z=(J=A>1)?l/A:l)%2?z-1:z,Q=(Q=J?E/A:E)%2?Q-1:Q,n.next=11,Object(_.a)().exportImage(z,Q,R,I);case 11:if(image=n.sent,W&&f.countProjectExport(e,o).catch((function(e){return D.a.error({error:e},"Encounter error counting project export")})),n.prev=13,!(k||null!=F&&F.url||B)){n.next=60;break}if(h.a.open({message:"Processing...",type:x.g.INFO,duration:3e3}),Z=[],ee=void 0,te=void 0,image=image.split(",")[1],re=Object(w.a)(image),ne=new Blob([re]),ae=R?"png":"jpg",oe="".concat(d.replaceAll(" ","-"),"-").concat(Object(T.a)(),".").concat(ae),Z.push(v.b.$services.multiUploadService.multipartUpload(ne,y.b.DEFAULT_IMAGE_EXPORT,{key:oe,contentType:"image/".concat(ae)})),null==k||!k.image){n.next=34;break}return ee="".concat(d.replaceAll(" ","-"),"-").concat(Object(T.a)()),n.next=29,fetch(k.image);case 29:return ce=n.sent,n.next=32,ce.blob();case 32:ie=n.sent,Z.push(v.b.$services.multiUploadService.multipartUpload(ie,y.b.DEFAULT_IMAGE_EXPORT,{key:ee}));case 34:if(null==F||!F.url){n.next=43;break}return te="".concat(d.replaceAll(" ","-"),"-").concat(Object(T.a)()),n.next=38,fetch(F.url);case 38:return ue=n.sent,n.next=41,ue.blob();case 41:se=n.sent,Z.push(v.b.$services.multiUploadService.multipartUpload(se,y.b.RENDERER_FOREGROUND,{key:te}));case 43:return n.next=45,Promise.all(Z);case 45:return n.next=47,r.$httpClient.post("".concat(C,"/export/default/init"),{projectId:o,filename:d,baseRenderKey:oe,uploadType:y.b.DEFAULT_IMAGE_EXPORT,width:l,height:E,contentType:H,highRes:J,scaleFactor:A,backgroundImageKey:ee,crop:null==k?void 0:k.crop,effect:{s3Key:te,applyOnBackground:(null==F?void 0:F.type)===m.b.BACKGROUND},color:null==k?void 0:k.color,addWatermark:B,sceneItemIds:V});case 47:return pe=n.sent,de=pe.data.renderId,v.b.$mixpanel.track("M-Download: default",{"Render Id":de,width:l,height:E,format:"PNG","With watermark":B}),le=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.$httpClient.get("".concat(C,"/export/default/status/").concat(de));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n.next=53,Object(P.a)(le,84e4);case 53:me=n.sent,Ee=me.presignedUrl,image=Ee,U&&f.publishSceneToCommunity(e,de).catch((function(e){return D.a.error({error:e},"Encounter error publishing default render to community")})),h.a.open({type:x.g.SUCCESS,message:"Your export is complete.",duration:3e3}),n.next=67;break;case 60:if(!J){n.next=67;break}return image=image.split(",")[1],fe=Object(w.a)(image),ge=new Blob([fe]),n.next=66,f.exportImageWithTransformation(e,{imageBlob:ge,width:l,height:E,filename:"".concat(d),isUpscale:!0,isPng:R,transparentBackground:I,isDownload:X});case 66:return n.abrupt("return",n.sent);case 67:n.next=72;break;case 69:n.prev=69,n.t0=n.catch(13),h.a.open({type:x.g.ERROR,text:"Problem with export. Please try again.",duration:3e3});case 72:if(!X){n.next=87;break}return Object(j.c)(image,K),n.next=76,Object(_.a)().exportImage(z,Q,R,I);case 76:return Oe=(Oe=n.sent).split(",")[1],Re=Object(w.a)(Oe),be=new Blob([Re]),he=R?"png":"jpg",xe="".concat(d.replaceAll(" ","-"),"-").concat(Object(T.a)(),".").concat(he),n.next=84,v.b.$services.multiUploadService.multipartUpload(be,y.b.USER_IMAGE,{key:xe,contentType:"image/".concat(he)});case 84:f.populateDefaultDownloadToMyDownloads(e,{key:xe,width:l,height:E,projectId:o,fileName:d,format:m.c.PNG}).catch((function(e){return D.a.error({error:e},"Encounter error populate default download to my download")})),O.addOrUpdateServerExportItem(e,{renderId:Object(T.a)(),fileName:d,progress:100,status:m.i.COMPLETED,format:Y,exportType:m.j.IMAGE,defaultDownloadUrl:Oe}),v.b.$mixpanel.track("Image Export",{Width:l,Height:E,Format:H,"Is Transparent Background":I,"With watermark":B});case 87:return n.abrupt("return",image);case 88:case"end":return n.stop()}}),n,null,[[13,69]])})))()})),Object(o.a)(n,m.a.FETCH_FBX_FILES,(function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c,d,l,E;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.commit,o=e.dispatch,r.prev=1,r.next=4,t.$httpClient.get("".concat(C,"/export/fbx/status"));case 4:d=r.sent,null!==(c=d.data)&&void 0!==c&&c.content&&(l=d.data.content,n("".concat(m.h,"/").concat(m.g.SET_EXPORTED_FBX_FILES),l,{root:!0}),E=!1,l.every((function(e){return!(!e.isFailed&&!e.fbxFileId)||(E=!0,!1)})),E&&o("".concat(m.h,"/").concat(m.a.SUBSCRIBE_TO_EXPORT_FBX_READY),void 0,{root:!0})),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),D.a.error({error:r.t0},"Failed to fetch FBX files status");case 11:case"end":return r.stop()}}),r,null,[[1,8]])})))()})),Object(o.a)(n,m.a.CANCEL_EXPORT_FBX,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.commit,n.prev=1,N&&N.cancel(),n.next=5,r.$httpClient.delete("".concat(C,"/export/fbx/").concat(t));case 5:o("".concat(m.h,"/").concat(m.g.DELETE_FBX_EXPORT_FILE),t,{root:!0}),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),D.a.error({error:n.t0},"Failed to fetch FBX files status");case 11:case"end":return n.stop()}}),n,null,[[1,8]])})))()})),Object(o.a)(n,m.a.DOWNLOAD_FBX_FILE,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d,l,E,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.dispatch,c=t.fbxFileId,d=t.exportName,l=t.exportId,n.prev=2,n.next=5,r.$httpClient.get("".concat(C,"/presigned/fbx/").concat(c),{params:{attachmentFilename:d}});case 5:return E=n.sent,f=E.data.presignedUrl,Object(R.$notify)({type:x.g.SUCCESS,title:"Your file will download in few seconds."}),Object(j.c)(f,d),v.b.$mixpanel.track("File Download",{"File Format":"FBX",Success:!0}),n.next=12,o("".concat(m.h,"/").concat(m.a.CANCEL_EXPORT_FBX),l,{root:!0});case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(2),Object(R.$notify)({type:x.g.ERROR,title:"Faild to download your file please try again."});case 17:case"end":return n.stop()}}),n,null,[[2,14]])})))()})),Object(o.a)(n,m.a.SUBSCRIBE_TO_EXPORT_FBX_READY,(function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r,n,o,d,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=e.commit,n=e.dispatch,o=I.c.lastInitSocketManager,d=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.exportFbx&&(n=t.exportFbx,r("".concat(m.h,"/").concat(m.g.UPDATE_EXPORT_FBX_FILE),n,{root:!0}),h.a.open({message:"Your project is successfully exported.",type:x.g.SUCCESS,duration:3e3}),X&&X.cancel(),v.b.$mixpanel.track("File Export",{"File Format":"FBX",Success:!0}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X?(X.cancel(),X=new I.a):X=new I.a,l=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n("".concat(m.h,"/").concat(m.a.FETCH_FBX_FILES),void 0,{root:!0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.next=8,o.subscribeRequestStream(I.b.SUBSCRIBE_FBX_EXPORTS,null,d,l,null,X);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),D.a.error({err:t.t0},"Encounter error subscribing for export fbx ready subscribe level");case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()})),Object(o.a)(n,m.a.EXPORT_FBX,(function(e,t){var r=this,n=e.commit,o=e.dispatch,d=t.projectTitle,l=t.exportType,E=t.projectId,O=t.doNotExportMuteLayers,h=t.startFrame,I=t.endFrame,S=(N=U.source()).token,w=Object(T.a)(),j=l&&l==m.d.SINGLE_ANIMATION_LAYER,P="".concat(d,".fbx");n("".concat(x.f,"/").concat(x.e.SET_ENGINE_LOADING_STATUS),{message:"Starting export..."},{root:!0}),f.countProjectExport(e,E).catch((function(e){return D.a.error({error:e},"Encounter error counting project export")})),setTimeout(Object(c.a)(regeneratorRuntime.mark((function e(){var t,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(_.a)().exportProject(d,!0,j,O,h,I);case 3:return t=e.sent,c=t.glTFFiles["".concat(d,".glb")],l="".concat(Object(T.a)(),".glb"),6e6,"application/octet-stream",e.next=10,v.b.$services.multiUploadService.multipartUpload(c,y.b.EXPORT_FBX,{key:l,partSize:6e6,contentType:"application/octet-stream"},S);case 10:return e.next=12,r.$httpClient.post("".concat(C,"/export/fbx/init"),{key:l,exportId:w,exportName:P,projectId:E},{cancelToken:S});case 12:n("".concat(m.h,"/").concat(m.g.SET_EXPORTED_FBX_FILES),{exportId:w,projectId:E,exportName:P,fbxFileId:null,isFailed:!1,errorMessage:null},{root:!0}),o("".concat(m.h,"/").concat(m.a.SUBSCRIBE_TO_EXPORT_FBX_READY),void 0,{root:!0}),n("".concat(m.h,"/").concat(m.g.SET_SHOW_EXPORT_MODAL),!0,{root:!0}),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),v.b.$mixpanel.track("File Export",{"File Format":"FBX",Success:!1}),Object(R.$notify)({type:x.g.ERROR,title:"Your file cannot be exported. Please try again.",duration:3e3});case 21:return e.prev=21,N=null,n("".concat(x.f,"/").concat(x.e.SET_ENGINE_LOADING_STATUS),null,{root:!0}),e.finish(21);case 25:case"end":return e.stop()}}),e,null,[[0,17,21,25]])}))),0)})),Object(o.a)(n,m.a.EXPORT_PROJECT,(function(e,t){var r=e.commit;r("".concat(x.f,"/").concat(x.e.SET_ENGINE_LOADING_STATUS),{message:"Exporting Assets..."},{root:!0});var n=t.projectId,o=t.filePrefix,c=t.asGLB,d=t.exportType,l=t.doNotExportMuteLayers,E=t.startFrame,R=t.endFrame,I=d&&d==m.d.SINGLE_ANIMATION_LAYER;f.countProjectExport(e,n).catch((function(e){return D.a.error({error:e},"Encounter error counting project export")})),setTimeout((function(){Object(_.a)().exportProject(o,c,I,l,E,R).then((function(t){t.downloadFiles();var r=Object(T.a)(),n=c?m.k.GLB:m.k.GLTF;O.addOrUpdateServerExportItem(e,{renderId:r,fileName:o,progress:100,status:m.i.COMPLETED,format:n,exportType:m.j.THREE_D,defaultDownloadUrl:t}),v.b.$mixpanel.track("File Export",{"File Format":n,Success:!0}),h.a.open({message:"Your project is successfully exported.",type:x.g.SUCCESS,duration:3e3})})).catch((function(){var e=c?"GLB":"GLTF";v.b.$mixpanel.track("File Export",{"File Format":e,Success:!1}),h.a.open({type:x.g.ERROR,message:"Your file cannot be exported. Please try again.",duration:3e3})})).finally((function(){r("".concat(x.f,"/").concat(x.e.SET_ENGINE_LOADING_STATUS),null,{root:!0})}))}),50)})),Object(o.a)(n,m.a.CHECK_CAN_EXPORT_3D_FILE,(function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$httpClient.put("".concat(C,"/export/3dfile/complete"));case 2:if(!(r=e.sent)||!r.data){e.next=8;break}return n=r.data.canRun,e.abrupt("return",n);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})))()})),Object(o.a)(n,m.a.SUBSCRIBE_TO_SERVER_RENDER_PROGRESS,(function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r,n,o,d,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=I.c.lastInitSocketManager,n=A.a.instance,o=function(){var t=Object(c.a)(regeneratorRuntime.mark((function t(r){var progress;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(progress=r.progress).progress&&(progress.progress=parseInt(progress.progress.replace("%","").replace(" ",""))),D.a.log("Received progress",progress.status),progress.status=Object(S.b)(progress.status),O.addOrUpdateServerExportItem(e,progress);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),d=function(){n.registerWebWorker()},M?(M.cancel(),M=new I.a):M=new I.a,l=function(){var t=Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.terminateWorker(),D.a.log("Reconnecting to render progress stream socket and fetch"),t.next=4,f.pollOngoingServerExportStatus(e);case 4:return t.next=6,r.subscribeRequestStream(I.b.SUBSCRIBE_RENDER_PROGRESS,null,o,l,d);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=9,r.subscribeRequestStream(I.b.SUBSCRIBE_RENDER_PROGRESS,null,o,l,d,M);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),D.a.error({err:t.t0},"Encounter error subscribing for server export");case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))()})),Object(o.a)(n,m.a.SERVER_RENDER,(function(e,t){var r=this,n=e.commit,o=t.projectId,d=t.width,l=void 0===d?1024:d,E=t.height,h=void 0===E?1024:E,I=t.samples,S=void 0===I?50:I,A=t.isSuperSampling,k=t.format,F=t.shadowSoftness,N=t.scaleFactor,X=void 0===N?1:N,M=t.skipEvents,U=void 0!==M&&M,L=t.fps,B=t.repeat,G=void 0===B?0:B,V=t.currentFrame,W=t.frameRange,H=t.exportType,Y=t.background,K=t.backgroundEffect,J=t.addWatermark,z=void 0!==J&&J,Q=t.sceneItemIds,Z=void 0===Q?[]:Q,ee=t.downloadImmediately,te=t.isDownload,re=void 0===te||te,ne=t.isPreviewFileRender,ae=void 0!==ne&&ne,oe=t.readyCallback,ce=t.serverExportIdChangeCallback,ie=t.serverConfigReadyCallback,ue=ae?t.fileName:"".concat(t.fileName," (HD)"),se=ae?"mnm":null,pe=Object(T.a)(),de=null;W&&(de=Math.ceil(W[1]/(L||24))),O.addOrUpdateServerExportItem(e,{renderId:pe,fileName:ue,progress:0,status:m.i.PREPARING,format:k,exportType:H,animationDuration:de,isPreviewFileRender:ae}),n("".concat(x.f,"/").concat(x.e.SET_ENGINE_LOADING_STATUS),{message:"Preparing for Cloud Render..."},{root:!0}),f.countProjectExport(e,o).catch((function(e){return D.a.error({error:e},"Encounter error counting project export")})),setTimeout(Object(c.a)(regeneratorRuntime.mark((function d(){var E,f,I,N,M,B,J,image;return regeneratorRuntime.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:return E=300,l>h?(N=E/l,f=E,I=Math.round(h*N)):(M=E/h,f=Math.round(l*M),I=E),I=I%2?I-1:I,f=f%2?f-1:f,B=Object(_.a)(),d.next=7,B.exportImage(f,I,!1,null==t.background);case 7:J=d.sent,image=J.split(",")[1],B.onAfterRenderObservable.addOnce(Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:B.exportProject(ue,!0,!0,!0,void 0,void 0,H===m.j.IMAGE).finally((function(){n("".concat(x.f,"/").concat(x.e.SET_ENGINE_LOADING_STATUS),null,{root:!0})})).then(function(){var t=Object(c.a)(regeneratorRuntime.mark((function t(n){var d,E,f,_,I,N,M,J,Q,te,body,ne,le,me,Ee,fe,ge,Oe,Re,be,he,xe,ve,_e,Ie,Te,Se,we,je,De,Pe,ye,Ae,ke,Fe,Ne,Xe;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}throw new Error("No GLB exported. Aborting cloud render.");case 2:if(ie&&ie(),ce&&ce({renderId:pe}),f=8e6,_="".concat(Object(T.a)(),".glb"),I=v.b.$services.multiUploadService.multipartUpload(n.glTFFiles["".concat(ue,".glb")],y.b.RENDERER_GLB,{key:_,partSize:f,contentType:"application/octet-stream"}),N=Object(w.a)(image),M=new Blob([N]),J="".concat(Object(T.a)(),".jpg"),Q=v.b.$services.multiUploadService.multipartUpload(M,y.b.RENDERER_THUMBNAIL,{key:J}),te=B.getServerRenderSettings(),body=JSON.stringify(te),ne=new Blob([body]),le="".concat(Object(T.a)(),".json"),me=v.b.$services.multiUploadService.multipartUpload(ne,y.b.RENDERER_CONFIG,{key:le,partSize:f,contentType:"application/json"}),D.a.log("config json",te),Ee=[I,me,Q],fe=void 0,ge=void 0,!Y){t.next=35;break}if(!Y.image){t.next=34;break}return t.next=24,fetch(Y.image);case 24:return Oe=t.sent,t.next=27,Oe.blob();case 27:Re=t.sent,be=Object(T.a)(),he=v.b.$services.multiUploadService.multipartUpload(Re,y.b.SERVER_RENDER_BACKGROUND,{key:be}),Ee.push(he),fe={s3Key:be,crop:Y.crop},t.next=35;break;case 34:Y.color&&(fe={color:Y.color});case 35:if(!K){t.next=47;break}if(!K.url){t.next=47;break}return t.next=39,fetch(K.url);case 39:return xe=t.sent,t.next=42,xe.blob();case 42:ve=t.sent,_e=Object(T.a)(),Ie=v.b.$services.multiUploadService.multipartUpload(ve,y.b.RENDERER_FOREGROUND,{key:_e}),Ee.push(Ie),ge={s3Key:_e,applyOnBackground:K.type===m.b.BACKGROUND};case 47:return t.next=49,Promise.all(Ee);case 49:return Te={glbS3Key:_,configS3Key:le,projectId:o,width:l,height:h,samples:S,format:k,shadowSoftness:F,fileName:ue,frameRange:W,currentFrame:V,scaleFactor:X,skipEvents:U,fps:L,repeat:G,exportType:H,background:fe,effect:ge,addWatermark:z,sceneItemIds:Z,exrFileId:null==te||null===(d=te.environment)||void 0===d||null===(E=d.environmentMap)||void 0===E?void 0:E.serverFileId,isSuperSampling:A,origin:se},Se=new URLSearchParams(window.location.search),we=Se.get("samples"),je=Se.get("width"),De=Se.get("height"),we&&(Te.samples=parseInt(we)),je&&(Te.width=parseInt(je)),De&&(Te.height=parseInt(De)),t.next=59,r.$httpClient.post("".concat(C,"/export/renderer/init"),Te);case 59:return Pe=t.sent,ye=Pe.data.renderId,ae||v.b.$mixpanel.track("M-Download: cloud-render",{"Render Id":ye,width:l,height:h,samples:S,format:k,"Shadow Softness":F,"With watermark":z}),U||ee||(v.b.$services.serverRenderProgressSimulator.updateRenderIdForExportItem(pe,ye),O.removeServerExportItem(e,pe),O.addOrUpdateServerExportItem(e,{renderId:ye,fileName:ue,progress:0,animationDuration:de,status:m.i.PREPARING,format:k,exportType:H}),ce&&ce({renderId:ye,isChangeCallback:!0,currentSelectedExport:e.state.selectedServerExportItem})),t.next=65,r.$httpClient.post("".concat(C,"/multipart/rendererThumbnail"),{key:J,contentType:"image/png",renderId:ye,uploadType:y.b.RENDERER_THUMBNAIL});case 65:if(Ae="",!U&&!ee){t.next=79;break}return ke=function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.$httpClient.get("".concat(C,"/export/renderer/status/").concat(ye));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.next=70,Object(P.a)(ke,84e4);case 70:if(Fe=t.sent,Ne=Fe.outputFileId,!Fe.isFailed){t.next=74;break}throw new Error("Failed to PixRender");case 74:return Xe="".concat(ue,".png"),t.next=77,$(r.$httpClient,Ne,Xe);case 77:Ae=t.sent,re&&(Object(j.c)(Ae,Xe),Object(R.$notify)({type:x.g.SUCCESS,title:"Your cloud render is complete.",duration:3e3}));case 79:oe&&oe(Ae);case 80:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){O.removeServerExportItem(e,pe),"400"!=t.status||t.data.canRun?(D.a.error("Encounter error server rendering",t),Object(R.$notify)({type:x.g.ERROR,title:"Problem with cloud render. Please try again.",duration:3e3})):Object(R.$notify)({type:x.g.WARN,title:"Maximum of 3 in progress cloud renders at a time",duration:3e3}),oe&&oe()}));case 2:case"end":return t.stop()}}),t)}))));case 10:case"end":return d.stop()}}),d)}))),50)})),Object(o.a)(n,m.a.FETCH_EXPORT_DOWNLOADS,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d,l,E,f,R,h,x,v,_,I,T,S,content,w,j,D;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o=t.refresh,c=t.refreshOnSuccess,d=void 0!==c&&c,l=t.page,E=t.pageSize,f=void 0===E?20:E,R=t.search,h=t.animation,x=t.status,v=t.sortBy,_=t.type,I={pageSize:f,page:l,search:R,animation:h?h==m.m.ANIMATED:void 0,status:x,sortBy:v,type:_},d||O.setIsFetchingExportDownloads(e,!0),o&&O.resetExportDownloads(e),n.next=7,r.$httpClient.get("".concat(C,"/export/downloads/status"),{params:I});case 7:(T=n.sent).data&&T.data.content&&(S=T.data,content=S.content,w=S.totalItems,j=S.totalPages,D=content.map((function(e){return{renderId:e.id,type:e.type,fileName:e.fileName,fileId:e.fileId,status:e.type==m.e.AI_GENERATED||e.fileId?m.i.COMPLETED:e.isFailed?m.i.FAILED:e.cancelled?m.i.CANCELLED:m.i.IN_PROGRESS,progress:e.type==m.e.HIGH_QUALITY?e.progress||0:void 0,prompt:e.prompt,format:e.format,exportType:e.exportType,thumbnailUrl:e.thumbnailUrl,size:e.size,updateDate:e.updatedAt,resolution:e.resolution,backgroundRemoved:e.backgroundRemoved}})),O.setExportDownloads(e,D,w,j,content.length?l+1:l,d));case 9:return n.prev=9,O.setIsFetchingExportDownloads(e,!1),n.finish(9);case 12:case"end":return n.stop()}}),n,null,[[0,,9,12]])})))()})),Object(o.a)(n,m.a.DOWNLOAD_EXPORT_DOWNLOAD,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:H(r.$httpClient,t);case 1:case"end":return e.stop()}}),e)})))()})),Object(o.a)(n,m.a.DOWNLOAD_AI_GENERATED_FILE,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.commit,n.prev=1,n.next=4,L(r.$httpClient,t);case 4:if(o=n.sent,c=o.downloadFileName,d=o.presignedUrl){n.next=9;break}return n.abrupt("return");case 9:Object(j.c)(d,c),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(1),Object(R.$notify)({type:x.g.ERROR,title:"Problem with download. Please try again.",duration:3e3});case 15:case"end":return n.stop()}}),n,null,[[1,12]])})))()})),Object(o.a)(n,m.a.DOWNLOAD_SERVER_RENDER_FILE_BY_RENDER_ID,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d,l,m,E,f,h,v,_;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=!1,n.prev=1,c=t.renderId,d=t.downloadIfNotDownloadedAlready,l=void 0!==d&&d,n.next=5,G(r.$httpClient,c);case 5:if(m=n.sent,E=m.outputFileId,f=m.exportType,h=m.fileName,v=m.format,_=m.downloaded,E){n.next=13;break}return n.abrupt("return",o);case 13:O.addOrUpdateServerExportItem(e,{renderId:c,fileName:h,format:v,exportType:f}),l&&_||(H(r.$httpClient,{outputFileId:E,exportType:f,fileName:h,format:v,renderId:c}),o=!0),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(1),Object(R.$notify)({type:x.g.ERROR,title:"Problem with download. Please try again.",duration:3e3});case 20:return n.abrupt("return",o);case 21:case"end":return n.stop()}}),n,null,[[1,17]])})))()})),Object(o.a)(n,m.a.DELETE_SERVER_RENDER_FILE,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.commit,n.prev=1,o("".concat(m.h,"/").concat(m.g.REMOVE_SERVER_EXPORT_ITEM),t,{root:!0}),n.next=5,r.$httpClient.delete("".concat(C,"/export/renderer/").concat(t));case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(1);case 9:case"end":return n.stop()}}),n,null,[[1,7]])})))()})),Object(o.a)(n,m.a.POLL_ONGOING_SERVER_EXPORT_STATUS,(function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c,d,l,E,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,n=k(e.state.serverExportItems),r.prev=2,n.s();case 4:if((o=n.n()).done){r.next=15;break}return c=o.value,r.next=8,t.$httpClient.get("".concat(C,"/export/renderer/status/").concat(c.renderId));case 8:d=r.sent,l=d.data,E=l.outputFileId,f=l.isFailed,O.addOrUpdateServerExportItem(e,{renderId:c.renderId,progress:c.progress,status:f?m.i.FAILED:E?m.i.COMPLETED:m.i.IN_PROGRESS,format:c.format,exportType:c.exportType});case 13:r.next=4;break;case 15:r.next=20;break;case 17:r.prev=17,r.t0=r.catch(2),n.e(r.t0);case 20:return r.prev=20,n.f(),r.finish(20);case 23:r.next=27;break;case 25:r.prev=25,r.t1=r.catch(0);case 27:case"end":return r.stop()}}),r,null,[[0,25],[2,17,20,23]])})))()})),Object(o.a)(n,m.a.RETRY_SERVER_RENDER_EXPORT,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=t.renderId,c=t.format,d=t.exportType,n.prev=1,O.addOrUpdateServerExportItem(e,{renderId:o,progress:0,status:m.i.PREPARING,format:c,exportType:d}),n.next=5,r.$httpClient.get("".concat(C,"/export/renderer/retry/").concat(o));case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(1);case 9:case"end":return n.stop()}}),n,null,[[1,7]])})))()})),Object(o.a)(n,m.a.CANCEL_SERVER_RENDER_EXPORT,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.commit,c=t.renderId,d=t.shouldRemove,l=void 0===d||d,n.prev=2,n.next=5,r.$httpClient.put("".concat(C,"/export/renderer/cancel/").concat(c));case 5:l&&o("".concat(m.h,"/").concat(m.g.REMOVE_SERVER_EXPORT_ITEM),c,{root:!0}),n.next=10;break;case 8:n.prev=8,n.t0=n.catch(2);case 10:case"end":return n.stop()}}),n,null,[[2,8]])})))()})),Object(o.a)(n,m.a.PUBLISH_SCENE_TO_COMMUNITY,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.commit,n.prev=1,n.next=4,r.$httpClient.put("".concat(C,"/export/renderer/publish/").concat(t));case 4:n.next=8;break;case 6:n.prev=6,n.t0=n.catch(1);case 8:case"end":return n.stop()}}),n,null,[[1,6]])})))()})),Object(o.a)(n,m.a.PUBLISH_AI_SCENE_TO_COMMUNITY,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.commit,n.prev=1,n.next=4,r.$httpClient.put("".concat(C,"/export/renderer/aistylist/publish/").concat(t));case 4:n.next=8;break;case 6:n.prev=6,n.t0=n.catch(1);case 8:case"end":return n.stop()}}),n,null,[[1,6]])})))()})),Object(o.a)(n,m.a.POPULATE_DEFAULT_DOWNLOAD_TO_MY_DOWNLOADS,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d,l,m,E;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.commit,o=t.width,c=t.height,d=t.format,l=t.projectId,m=t.fileName,E=t.key,n.prev=2,n.next=5,r.$httpClient.put("".concat(C,"/export/default/mydownloads"),{key:E,type:y.b.USER_IMAGE,projectId:l,fileName:m,width:o,height:c,format:d});case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(2);case 9:case"end":return n.stop()}}),n,null,[[2,7]])})))()})),Object(o.a)(n,m.a.POPULATE_IMAGE_TO_MY_DOWNLOADS,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d,l,m,E;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.commit,o=t.width,c=t.height,d=t.isRemoveBackground,l=t.isUpscale,m=t.jobId,E=t.imageStyleId,n.prev=2,n.next=5,r.$httpClient.put("".concat(C,"/export/renderer/aistylist/mydownloads/").concat(E),{scaledHeight:c,scaledWidth:o,backgroundRemoved:d,highResolution:l,upScaleJobId:m});case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(2);case 9:case"end":return n.stop()}}),n,null,[[2,7]])})))()})),Object(o.a)(n,m.a.EXPORT_IMAGE_WITH_TRANSFORMATION,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,c,d,l,E,f,R,_,I,S,w,P,A,k,F,N,X,M,U;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o=t.imageBlob,c=t.filename,d=t.width,l=t.height,E=t.isPng,f=t.transparentBackground,R=t.isUpscale,_=t.isRemoveBackground,I=t.isDownload,h.a.open({message:"Processing...",type:x.g.INFO,duration:3e3}),S=E?"png":"jpg",w=E?m.k.PNG:m.k.JPEG,P="".concat(c.replaceAll(" ","-"),"-").concat(Object(T.a)(),".").concat(S),n.next=8,v.b.$services.multiUploadService.multipartUpload(o,y.b.IMAGE_UPSCALE,{key:P,contentType:"image/".concat(S)});case 8:return n.next=10,r.$httpClient.post("".concat(C,"/export/upscale/init"),{key:P,type:y.b.IMAGE_UPSCALE,contentType:"image/".concat(S),upscale:R?{width:d,height:l}:void 0,isRemoveBackground:_});case 10:if(A=n.sent,k=A.data||{},!(F=k.jobId)){n.next=21;break}return N="".concat(c,".").concat(S),n.next=16,r.$httpClient.get("".concat(C,"/export/upscale/").concat(F),{params:{fileName:N}});case 16:if(X=n.sent,M=X.data||{},!(U=M.url)){n.next=21;break}return I&&(Object(j.c)(U,N),O.addOrUpdateServerExportItem(e,{renderId:Object(T.a)(),fileName:c,progress:100,status:m.i.COMPLETED,format:w,exportType:m.j.IMAGE,defaultDownloadUrl:U}),h.a.open({type:x.g.SUCCESS,message:"Your export is complete.",duration:3e3}),v.b.$mixpanel.track("Image Export",{Format:E?"image/png":"image/jpg",Width:d,Height:l,"Is Transparent Background":f||_,"Is Upscale":R,"Is Remove Background":_})),n.abrupt("return",U);case 21:n.next=27;break;case 23:n.prev=23,n.t0=n.catch(0),D.a.error("Encounter error server rendering",n.t0),h.a.open({type:x.g.ERROR,text:"Problem with export. Please try again.",duration:3e3});case 27:case"end":return n.stop()}}),n,null,[[0,23]])})))()})),Object(o.a)(n,m.a.EXPORT_AI_STYLED_IMAGE_WITH_TRANSFORMATION,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,d,l,m,E,O,_,I,T,S,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o=t.presignedUrl,d=t.filename,l=t.width,m=t.height,E=t.isPng,O=t.transparentBackground,_=t.isUpscale,I=t.isRemoveBackground,T=t.imageStyleId,h.a.open({message:"Processing...",type:x.g.INFO,duration:3e3}),n.next=5,r.$httpClient.post("".concat(C,"/export/removebg"),{presignedUrl:o,type:y.b.IMAGE_UPSCALE});case 5:if(!(S=n.sent).data){n.next=22;break}if(w=d,!S.data.jobId||!S.data.presignedUrl){n.next=18;break}if(!T){n.next=12;break}return n.next=12,f.populateImageToMyDownloads(e,{width:l,height:m,isRemoveBackground:I,isUpscale:_,jobId:S.data.jobId,imageStyleId:T});case 12:return Object(j.b)(S.data.presignedUrl,w),Object(R.$notify)({type:x.g.SUCCESS,title:"Your export is complete.",duration:3e3,clean:!0}),v.b.$mixpanel.track("AI Style Image Export",{Format:E?"image/png":"image/jpg",Width:l,Height:m,"Is Transparent Background":O||I,"Is Upscale":_,"Is Remove Background":I}),n.abrupt("return",{});case 18:if(!S.data.jobId){n.next=22;break}return n.next=21,new Promise((function(t){var n=setInterval(Object(c.a)(regeneratorRuntime.mark((function o(){var c,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.$httpClient.get("".concat(C,"/export/removebg/").concat(S.data.jobId));case 2:if(null==(d=o.sent)||null===(c=d.data)||void 0===c||!c.presignedUrl){o.next=13;break}return t(d.data),clearInterval(n),o.next=8,Object(j.b)(d.data.presignedUrl,w);case 8:if(!T){o.next=11;break}return o.next=11,f.populateImageToMyDownloads(e,{width:l,height:m,isRemoveBackground:I,isUpscale:_,jobId:S.data.jobId,imageStyleId:T});case 11:Object(R.$notify)({type:x.g.SUCCESS,title:"Your export is complete.",duration:3e3,clean:!0}),v.b.$mixpanel.track("AI Style Image Export",{Format:E?"image/png":"image/jpg",Width:l,Height:m,"Is Transparent Background":O||I,"Is Upscale":_,"Is Remove Background":I});case 13:case"end":return o.stop()}}),o)}))),2e3)}));case 21:case 22:return n.abrupt("return",{});case 25:return n.prev=25,n.t0=n.catch(0),D.a.error("Encounter error server rendering",n.t0),Object(R.$notify)({type:x.g.ERROR,title:"Problem with AI Styled export. Please try again.",duration:3e3,clean:!0}),n.abrupt("return",{error:n.t0});case 30:case"end":return n.stop()}}),n,null,[[0,25]])})))()})),Object(o.a)(n,m.a.COUNT_PROJECT_EXPORT,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.commit,n.prev=1,o=Object(_.a)().getAllItemsInScene().map((function(e){return e.itemId})),n.next=5,r.$httpClient.put("".concat(C,"/project/").concat(t,"/export"),{itemIds:o});case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(1);case 9:case"end":return n.stop()}}),n,null,[[1,7]])})))()})),Object(o.a)(n,m.a.EXPORT_SELECTED_IMAGE,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,o,c,d,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:return n=e.sent,e.next=6,n.blob();case 6:return o=e.sent,c="img-".concat(Object(T.a)(),".png"),e.next=10,v.b.$services.multiUploadService.multipartUpload(o,y.b.DEFAULT_IMAGE_EXPORT,{key:c,contentType:"image/png"});case 10:return e.next=12,r.$httpClient.post("".concat(C,"/export/downloads/watermarked"),{key:c,uploadType:y.b.DEFAULT_IMAGE_EXPORT,contentType:"image/png"});case 12:(d=e.sent)&&(l=d.data.url,Object(j.c)(l,c)),e.next=18;break;case 16:e.prev=16,e.t0=e.catch(0);case 18:case"end":return e.stop()}}),e,null,[[0,16]])})))()})),Object(o.a)(n,m.a.REMOVE_IMAGE_BACKGROUND,(function(e,t){var r=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var image,n,o,d,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,image=t.split(",")[1],n=Object(w.a)(image),o=new Blob([n]),d="image-remove-bg-".concat(Object(T.a)(),".png"),e.next=7,v.b.$services.multiUploadService.multipartUpload(o,y.b.IMAGE_UPSCALE,{key:d,contentType:"image/png"});case 7:return e.next=9,r.$httpClient.post("".concat(C,"/export/removebg"),{key:d,type:y.b.IMAGE_UPSCALE});case 9:if(!(l=e.sent).data){e.next=17;break}if(!l.data.presignedUrl){e.next=13;break}return e.abrupt("return",l.data);case 13:if(!l.data.jobId){e.next=17;break}return e.next=16,new Promise((function(e){var t=setInterval(Object(c.a)(regeneratorRuntime.mark((function n(){var o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.$httpClient.get("".concat(C,"/export/removebg/").concat(l.data.jobId));case 2:if(null==(c=n.sent)||null===(o=c.data)||void 0===o||!o.presignedUrl){n.next=7;break}return e(c.data),clearInterval(t),n.abrupt("return",c.data);case 7:case"end":return n.stop()}}),n)}))),2e3)}));case 16:return e.abrupt("return",e.sent);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),Object(R.$notify)({type:x.g.ERROR,title:"Failed to remove background, please try again"});case 22:case"end":return e.stop()}}),e,null,[[0,19]])})))()})),n),z=(r(26),r(29),r(25),r(30),r(55));r(254),r(28),r(194);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ee=(K={},Object(o.a)(K,m.g.SET_SHOW_EXPORT_MODAL,(function(e,t){e.showExportFBXModal=t})),Object(o.a)(K,m.g.SET_SHOW_EXPORT_IMAGE_MODAL,(function(e,t){e.showExportImageModal=t})),Object(o.a)(K,m.g.SET_EXPORT_VIDEO_MODAL,(function(e,t){e.exportVideoModal=t})),Object(o.a)(K,m.g.SET_EXPORT_GIF_MODAL,(function(e,t){e.exportGifModal=t})),Object(o.a)(K,m.g.SET_SHOW_EXPORT_PROJECT_MODAL,(function(e,t){e.showExportProjectModal=t})),Object(o.a)(K,m.g.SET_EXPORTED_FBX_FILES,(function(e,t){if(Array.isArray(t))e.exportedFBXFiles=t;else{var r=Object(z.a)(e.exportedFBXFiles);r.unshift(t),e.exportedFBXFiles=r}})),Object(o.a)(K,m.g.UPDATE_EXPORT_FBX_FILE,(function(e,t){var r=Object(z.a)(e.exportedFBXFiles),n=r.findIndex((function(e){return e.exportId==t.exportId}));n>=0&&(r[n]=t),e.exportedFBXFiles=r})),Object(o.a)(K,m.g.DELETE_FBX_EXPORT_FILE,(function(e,t){var r=e.exportedFBXFiles;e.exportedFBXFiles=r.filter((function(e){return e.exportId!==t}))})),Object(o.a)(K,m.g.SET_IS_EXPORTING_VIDEO,(function(e,t){e.isExportingVideo=t})),Object(o.a)(K,m.g.UPDATE_EXPORTING_VIDEO_STATUS,(function(e,t){e.exportingVideoProgress=t})),Object(o.a)(K,m.g.SET_VIDEO_EXPORT_PAYLOAD,(function(e,t){e.exportVideoPayload=t})),Object(o.a)(K,m.g.SET_EXPORT_MODAL_ACTIVE_TAB,(function(e,t){e.exportModalActiveTab=t})),Object(o.a)(K,m.g.SET_EXPORT_ITEMS_FILTER,(function(e,t){e.exportItemsFilter=Z(Z({},e.exportItemsFilter),t)})),Object(o.a)(K,m.g.ADD_OR_UPDATE_SERVER_EXPORT_ITEM,(function(e,t){var r=Object(z.a)(e.serverExportItems),n=r.findIndex((function(e){return e.renderId==t.renderId}));n>=0&&t.status==m.i.REMOVED?r.splice(n,1):n>=0?r[n]=Z(Z({},r[n]),t):r.unshift(Z({},t)),e.serverExportItems=r})),Object(o.a)(K,m.g.REMOVE_SERVER_EXPORT_ITEM,(function(e,t){var r=e.serverExportItems.findIndex((function(e){return e.renderId==t}));if(r>=0){var n=Object(z.a)(e.serverExportItems);n.splice(r,1),e.serverExportItems=n}})),Object(o.a)(K,m.g.RESET_SERVER_EXPORT_ITEMS,(function(e){e.serverExportItems=[]})),Object(o.a)(K,m.g.SET_IS_FETCHING_EXPORT_DOWNLOADS,(function(e,t){e.isFetchingExportDownloadItems=t})),Object(o.a)(K,m.g.SET_EXPORT_DOWNLOADS,(function(e,t){var r=t.items,n=t.totalItems,o=t.totalPages,c=t.currentPage,d=t.refresh;e.exportDownloadItems=d?r:[].concat(Object(z.a)(e.exportDownloadItems),Object(z.a)(r)),e.totalExportDownloadItems=n,e.currentPage=c,e.totalPages=o})),Object(o.a)(K,m.g.ADD_OR_UPDATE_EXPORT_DOWNLOAD_ITEM,(function(e,t){var r=Object(z.a)(e.exportDownloadItems),n=e.exportDownloadItems.findIndex((function(e){return e.renderId==t.renderId})),o=!0;e.exportItemsFilter.currentPage||e.exportItemsFilter.exportStatus&&t.status!==e.exportItemsFilter.exportStatus||e.exportItemsFilter.exportDownloadType==m.e.AI_GENERATED?o=!1:!e.exportItemsFilter.search||t.fileName&&t.fileName.toLowerCase().includes(e.exportItemsFilter.search.toLowerCase())||(o=!1),o=o&&t.status!==m.i.REMOVED,n>=0&&!o?(r.splice(n,1),e.totalExportDownloadItems-=1):n>=0&&o?r[n]=Z(Z({},r[n]),t):o&&(r.unshift(t),e.totalExportDownloadItems+=1),e.exportDownloadItems=r})),Object(o.a)(K,m.g.REMOVE_EXPORT_DOWNLOAD_ITEM,(function(e,t){var r=e.exportDownloadItems.findIndex((function(e){return e.renderId==t}));if(r>=0){var n=Object(z.a)(e.exportDownloadItems);n.splice(r,1),e.exportDownloadItems=n,e.totalExportDownloadItems--}})),Object(o.a)(K,m.g.SET_SELECTED_SERVER_EXPORT_ITEM,(function(e,t){e.selectedServerExportItem=t})),Object(o.a)(K,m.g.SET_SERVER_EXPORT_ITEM_TO_CANCEL,(function(e,t){e.serverExportItemToCancel=t})),Object(o.a)(K,m.g.RESET_EXPORT_DOWNLOADS,(function(e){e.exportDownloadItems=[],e.totalExportDownloadItems=null,e.currentPage=0,e.totalPages=null})),K),te=function(){return{showExportFBXModal:!1,showExportImageModal:!1,exportVideoModal:void 0,exportGifModal:void 0,showExportProjectModal:null,exportedFBXFiles:[],isExportingVideo:!1,exportingVideoProgress:null,exportVideoPayload:null,exportModalActiveTab:null,exportItemsFilter:{sortBy:x.h.RECENT,currentPage:0},serverExportItems:[],isFetchingExportDownloadItems:!1,exportDownloadItems:[],totalExportDownloadItems:null,currentPage:0,totalPages:null,selectedServerExportItem:null,serverExportItemToCancel:null}};function re(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,a){if(e){if("string"==typeof e)return ne(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ne(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,c=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw c}}}}function ne(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,r=Array(a);t<a;t++)r[t]=e[t];return r}var ae=Object(o.a)({},m.f.IS_SERVER_EXPORT_LIMIT_EXCEEDED,(function(e){var t,r=0,n=re(e.serverExportItems);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.status!==m.i.IN_PROGRESS&&o.status!==m.i.PREPARING||(r+=1),r>=S.a)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}))}}]);
//# sourceMappingURL=m2w9t2nt.17443a7c.js.map